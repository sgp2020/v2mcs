<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="net.muratec.mcs.mapper.TestCarrierMapper" >
  <resultMap id="BaseResultMap" type="net.muratec.mcs.model.TestCarrier" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    <id column="TEST_CARRIER_ID" property="testCarrierId" jdbcType="VARCHAR" />
    <result column="TEST_LEVEL" property="testLevel" jdbcType="DECIMAL" />
    <result column="TEST_START_TIME" property="testStartTime" jdbcType="VARCHAR" />
    <result column="TEST_END_TIME" property="testEndTime" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    TEST_CARRIER_ID, TEST_LEVEL, TEST_START_TIME, TEST_END_TIME
  </sql>
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="net.muratec.mcs.model.TestCarrierExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from TEST_CARRIER
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    select 
    <include refid="Base_Column_List" />
    from TEST_CARRIER
    where TEST_CARRIER_ID = #{testCarrierId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    delete from TEST_CARRIER
    where TEST_CARRIER_ID = #{testCarrierId,jdbcType=VARCHAR}
  </delete>
  <delete id="deleteByExample" parameterType="net.muratec.mcs.model.TestCarrierExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    delete from TEST_CARRIER
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="net.muratec.mcs.model.TestCarrier" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    insert into TEST_CARRIER (TEST_CARRIER_ID, TEST_LEVEL, TEST_START_TIME, 
      TEST_END_TIME)
    values (#{testCarrierId,jdbcType=VARCHAR}, #{testLevel,jdbcType=DECIMAL}, #{testStartTime,jdbcType=VARCHAR}, 
      #{testEndTime,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="net.muratec.mcs.model.TestCarrier" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    insert into TEST_CARRIER
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="testCarrierId != null" >
        TEST_CARRIER_ID,
      </if>
      <if test="testLevel != null" >
        TEST_LEVEL,
      </if>
      <if test="testStartTime != null" >
        TEST_START_TIME,
      </if>
      <if test="testEndTime != null" >
        TEST_END_TIME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="testCarrierId != null" >
        #{testCarrierId,jdbcType=VARCHAR},
      </if>
      <if test="testLevel != null" >
        #{testLevel,jdbcType=DECIMAL},
      </if>
      <if test="testStartTime != null" >
        #{testStartTime,jdbcType=VARCHAR},
      </if>
      <if test="testEndTime != null" >
        #{testEndTime,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="net.muratec.mcs.model.TestCarrierExample" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    select count(*) from TEST_CARRIER
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    update TEST_CARRIER
    <set >
      <if test="record.testCarrierId != null" >
        TEST_CARRIER_ID = #{record.testCarrierId,jdbcType=VARCHAR},
      </if>
      <if test="record.testLevel != null" >
        TEST_LEVEL = #{record.testLevel,jdbcType=DECIMAL},
      </if>
      <if test="record.testStartTime != null" >
        TEST_START_TIME = #{record.testStartTime,jdbcType=VARCHAR},
      </if>
      <if test="record.testEndTime != null" >
        TEST_END_TIME = #{record.testEndTime,jdbcType=VARCHAR},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    update TEST_CARRIER
    set TEST_CARRIER_ID = #{record.testCarrierId,jdbcType=VARCHAR},
      TEST_LEVEL = #{record.testLevel,jdbcType=DECIMAL},
      TEST_START_TIME = #{record.testStartTime,jdbcType=VARCHAR},
      TEST_END_TIME = #{record.testEndTime,jdbcType=VARCHAR}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="net.muratec.mcs.model.TestCarrier" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    update TEST_CARRIER
    <set >
      <if test="testLevel != null" >
        TEST_LEVEL = #{testLevel,jdbcType=DECIMAL},
      </if>
      <if test="testStartTime != null" >
        TEST_START_TIME = #{testStartTime,jdbcType=VARCHAR},
      </if>
      <if test="testEndTime != null" >
        TEST_END_TIME = #{testEndTime,jdbcType=VARCHAR},
      </if>
    </set>
    where TEST_CARRIER_ID = #{testCarrierId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="net.muratec.mcs.model.TestCarrier" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 12 17:20:28 CST 2020.
    -->
    update TEST_CARRIER
    set TEST_LEVEL = #{testLevel,jdbcType=DECIMAL},
      TEST_START_TIME = #{testStartTime,jdbcType=VARCHAR},
      TEST_END_TIME = #{testEndTime,jdbcType=VARCHAR}
    where TEST_CARRIER_ID = #{testCarrierId,jdbcType=VARCHAR}
  </update>
  
  <!-- 以下独自SQL -->
  <!-- レコード取得範囲決定部 -->
  <sql id="selectRecordWhere">
    <where>
      <if test="fromRecordNum != null and toRecordNum != null">
       rn between #{fromRecordNum,jdbcType=DECIMAL} and #{toRecordNum,jdbcType=DECIMAL}
      </if>
    </where>
  </sql>
  <sql id="selectBoxWhere">
    <where>
   
      <if test="status != null and status != '' and status == '1'.toString()">
		     NVL(test_carrier.test_start_time, '0000000000000000' ) &lt;= CONCAT(to_char(SYSDATE,'YYYYMMDDHHMISS'),'00') 
    	 AND NVL(test_carrier.test_end_time,   '9999999999999999' ) &gt; CONCAT(to_char(SYSDATE,'YYYYMMDDHHMISS'),'00') 
      </if>
	  <if test="status != null and status != '' and status == '2'.toString() ">
	  		 test_carrier.test_end_time &lt; CONCAT(to_char(SYSDATE,'YYYYMMDDHHMISS'),'00')  
	  </if>
	  <if test="status != null and status != '' and status == '3'.toString() ">
	  		 test_carrier.test_start_time &gt;= CONCAT(to_char(SYSDATE,'YYYYMMDDHHMISS'),'00')  
	  </if>
	  <if test="currentTscId != null and currentTscId != ''">
        AND carrier.current_tsc_id = #{currentTscId}
      </if>
      <if test="carrierId != null and carrierId != ''">
        AND test_carrier.test_carrier_id LIKE #{carrierId}||'%' ESCAPE '${@net.muratec.mcs.common.ComConst@SQL_ESCAPE}'
      </if>
	  
    </where>
  </sql>

  <select id="getCount" parameterType="net.muratec.mcs.entity.info.ReqGetTestCarrierListEntity" resultType="java.lang.Integer"> 
		SELECT 
  			count(*) 
		FROM   test_carrier 
		LEFT OUTER JOIN carrier ON carrier.carrier_id = test_carrier.test_carrier_id 
		LEFT OUTER JOIN transfer ON transfer.carrier_id = carrier.carrier_id 
  		<include refid="selectBoxWhere" />
  </select>
  
  <resultMap id="SearchResultMap" type="net.muratec.mcs.model.TestCarrierModel">
    <id column="TEST_CARRIER_ID" jdbcType="VARCHAR" property="testCarrierId" />
    <result column="RN" jdbcType="DECIMAL" property="rn" />
    <result column="CURRENT_TSC_ID" jdbcType="VARCHAR" property="currentTscId" />
    <result column="CURRENT_LOC" jdbcType="VARCHAR" property="currentLoc" />
    <result column="CURRENT_ZONE_ID" jdbcType="VARCHAR" property="currentZoneId" />
    <result column="TSC_ID" jdbcType="VARCHAR" property="atomicTscId" />
    <result column="SRC_LOC" jdbcType="VARCHAR" property="atomicSource" />
    <result column="DST_LOC" jdbcType="VARCHAR" property="atomicDestination" />
    <result column="ORG_DST_TSC_ID" jdbcType="VARCHAR" property="transferDestination" />
    <result column="TEST_START_TIME" jdbcType="VARCHAR" property="testStartTime" />
    <result column="TEST_END_TIME" jdbcType="VARCHAR" property="testEndTime" />
   </resultMap>
  <!--  TestCarrier情報一覧を取得する。 -->
  <select id="selectTestCarrierList" parameterType="net.muratec.mcs.entity.info.ReqGetTestCarrierListEntity" resultMap="SearchResultMap">
		SELECT
			rn, 		
			test_carrier_id,
			current_tsc_id, 
			current_loc, 
			current_zone_id, 
			tsc_id, 
			src_loc, 
			dst_loc, 
			org_dst_tsc_id, 
			test_start_time, 
			test_end_time
		FROM
		(
				SELECT 
						row_number() over(order by test_carrier.test_carrier_id ) rn,
						test_carrier.test_carrier_id, 
						(select tsc.TSC_ABBREVIATION from tsc where carrier.current_tsc_id = tsc.tsc_id ) current_tsc_id, 
						carrier.current_loc, 
						carrier.current_zone_id, 
						(select tsc.TSC_ABBREVIATION from tsc where transfer.tsc_id = tsc.tsc_id ) tsc_id, 
		        		transfer.src_loc, 
						transfer.dst_loc, 
						(select tsc.TSC_ABBREVIATION from tsc where transfer.org_dst_tsc_id = tsc.tsc_id )org_dst_tsc_id, 
						test_carrier.test_start_time, 
						test_carrier.test_end_time  
				FROM   test_carrier 
				LEFT OUTER JOIN carrier ON carrier.carrier_id = test_carrier.test_carrier_id 
				LEFT OUTER JOIN transfer ON transfer.carrier_id = carrier.carrier_id 
	   			<include refid="selectBoxWhere" />
	   			ORDER BY test_carrier.test_carrier_id 
		)
       <include refid="selectRecordWhere" />
       
  </select>
</mapper>